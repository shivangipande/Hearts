<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rhythms of Life - Animal Heartbeat Database</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ù§Ô∏è</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <style>
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: rgba(0,0,0,0.9);
            --bg-tertiary: #333;
            --text-primary: white;
            --text-secondary: #ccc;
            --border-color: #555;
            --accent-color: #ff4444;
        }
        
        [data-theme="light"] {
            --bg-primary: #f5f5f5;
            --bg-secondary: rgba(255,255,255,0.95);
            --bg-tertiary: #e0e0e0;
            --text-primary: #333;
            --text-secondary: #666;
            --border-color: #ccc;
            --accent-color: #d63384;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: var(--bg-primary);
            font-family: 'Ginto', Arial, Helvetica, sans-serif;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        .header {
            background: var(--bg-secondary);
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: visible;
        }
        
        .controls {
            display: flex;
            align-items: baseline;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .controls input, .controls select, .controls button {
            padding: 10px 12px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'Ginto', Arial, Helvetica, sans-serif;
            font-size: 14px;
            transition: all 0.2s ease;
            min-height: 40px;
            box-sizing: border-box;
        }
        
        .controls input {
            width: 220px;
        }
        
        .controls select {
            padding: 10px 35px 10px 12px;
            min-width: 120px;
            position: relative;
            z-index: 10;
            margin: 0;
            outline: none;
            display: inline-block;
            vertical-align: baseline;
        }
        
        .custom-select {
            position: relative;
            display: inline-block;
            min-width: 120px;
            z-index: 100000;
        }
        
        .select-trigger {
            padding: 10px 35px 10px 12px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'Ginto', Arial, Helvetica, sans-serif;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 40px;
            box-sizing: border-box;
        }
        
        .select-trigger:hover {
            background: var(--accent-color);
        }
        
        .arrow {
            font-size: 10px;
            transition: transform 0.2s;
            opacity: 0.7;
        }
        
        .custom-select.open .arrow {
            transform: rotate(180deg);
        }
        
        .select-options {
            position: fixed;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-top: 2px;
            display: none;
            z-index: 999999;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
            min-width: 120px;
        }
        
        .custom-select.open .select-options {
            display: block;
        }
        
        .option {
            padding: 10px 12px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .option:hover {
            background: var(--accent-color);
        }
        
        .option:first-child {
            border-radius: 6px 6px 0 0;
        }
        
        .option:last-child {
            border-radius: 0 0 6px 6px;
        }
        
        .controls button {
            min-width: 44px;
            cursor: pointer;
        }
        
        .controls button:hover {
            background: var(--accent-color);
        }
        
        .toggle-btn {
            background: var(--accent-color) !important;
        }
        
        .toggle-btn.active {
            background: #28a745 !important;
        }
        
        .info {
            background: var(--bg-secondary);
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            font-size: 12px;
            text-align: right;
        }
        
        #canvas-container {
            margin-top: 0;
            position: relative;
            z-index: 1;
        }
        
        .tooltip {
            position: absolute;
            background: var(--bg-secondary);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 12px;
            pointer-events: none;
            z-index: 1000;
            font-size: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            max-width: 250px;
            display: none;
        }
        
        .tooltip h4 {
            margin: 0 0 8px 0;
            color: var(--accent-color);
            font-size: 14px;
        }
        
        .tooltip .stat {
            margin: 4px 0;
            display: flex;
            justify-content: space-between;
        }
        
        .tooltip .stat-label {
            color: var(--text-secondary);
        }
        
        .tooltip .stat-value {
            color: var(--text-primary);
            font-weight: bold;
        }
        
        .info-icon {
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 14px;
            margin-left: 5px;
            opacity: 0.7;
            transition: opacity 0.2s;
            user-select: none;
        }
        
        .info-icon:hover {
            opacity: 1;
            color: var(--accent-color);
        }
        
        .export-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .export-content {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            max-width: 400px;
            min-width: 320px;
            width: auto;
            box-sizing: border-box;
        }
        
        .export-content h3 {
            margin-top: 0;
            color: var(--accent-color);
        }
        
        .info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2500;
        }
        
        .info-content {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            max-width: 500px;
            min-width: 320px;
            width: auto;
            box-sizing: border-box;
            backdrop-filter: blur(10px);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .info-content h3 {
            margin-top: 0;
            color: var(--accent-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-content p {
            line-height: 1.5;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .info-content ul {
            margin: 15px 0;
            padding-left: 20px;
            color: var(--text-primary);
        }
        
        .info-content li {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .empathy-scale-demo {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--border-color);
        }
        
        .scale-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            font-size: 13px;
        }
        
        .scale-hearts {
            font-size: 14px;
        }
        
        .export-options {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .export-options button {
            padding: 12px 18px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Ginto', Arial, Helvetica, sans-serif;
            font-size: 14px;
            white-space: nowrap;
            min-width: 140px;
        }
        
        .export-options button:hover {
            background: var(--accent-color);
        }
        
        .embed-code {
            width: 100%;
            height: 100px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 10px;
            font-family: 'Ginto', Arial, Helvetica, sans-serif;
            font-size: 11px;
            resize: vertical;
        }
        
        .intro-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(3px);
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .intro-poem {
            color: white;
            font-size: 24px;
            line-height: 1.6;
            font-style: italic;
            font-family: 'Playfair Display', serif;
            text-shadow: 0 2px 8px rgba(0,0,0,0.7);
            margin-bottom: 30px;
            max-width: 90%;
            font-weight: 300;
            text-align: center;
        }
        
        .intro-arrow {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 10px 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .intro-arrow:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .intro-arrow::after {
            content: 'ENTER';
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: normal;
            font-style: normal;
        }
        
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
            
            .header {
                flex-direction: column;
                align-items: stretch;
                padding: 15px;
                gap: 15px;
                overflow-x: hidden;
            }
            
            .controls {
                display: flex;
                gap: 8px;
                align-items: center;
                flex-wrap: nowrap;
                overflow-x: hidden;
                max-width: 100%;
            }
            
            .search-row {
                flex: 1;
                min-width: 120px;
            }
            
            .search-row input {
                width: 100%;
                font-size: 16px;
                padding: 12px 16px;
                border-radius: 8px;
                text-align: left;
                box-sizing: border-box;
            }
            
            .buttons-row {
                display: flex;
                gap: 6px;
                flex-shrink: 0;
            }
            
            #sortSelect {
                display: none !important;
            }
            
            #cleanViewBtn {
                display: none !important;
            }
            
            .buttons-row button {
                padding: 10px;
                font-size: 14px;
                min-width: 44px;
                min-height: 44px;
                border-radius: 6px;
                flex-shrink: 0;
            }
            
            .info {
                text-align: center;
                font-size: 12px;
                padding: 12px 15px;
                margin: 5px 0;
                border-radius: 6px;
            }
            
            .info strong {
                font-size: 16px;
                display: block;
                margin-bottom: 4px;
            }
            
            .info small {
                display: block;
                margin-top: 3px;
                font-size: 10px;
                line-height: 1.3;
            }
            
            #canvas-container {
                margin-top: 10px;
            }
            
            .intro-poem {
                font-size: 18px;
                padding: 0 20px;
                line-height: 1.5;
                margin-bottom: 30px;
            }
            
            .intro-arrow {
                padding: 14px 24px;
            }
            
            .tooltip {
                max-width: 180px;
                font-size: 11px;
                padding: 10px;
            }
            
            .export-content {
                margin: 15px;
                width: calc(100% - 30px);
                padding: 20px;
            }
            
            .export-options {
                flex-direction: column;
                gap: 10px;
            }
            
            .export-options button {
                width: 100%;
                padding: 14px 18px;
            }
            
            footer {
                padding: 20px 15px !important;
                margin-top: 25px !important;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 12px;
                gap: 12px;
            }
            
            .controls {
                gap: 6px;
            }
            
            .search-row {
                min-width: 120px;
                max-width: 65%;
            }
            
            .search-row input {
                font-size: 16px;
                padding: 10px 12px;
            }
            
            .buttons-row {
                gap: 4px;
            }
            
            .buttons-row button {
                padding: 8px;
                min-width: 40px;
                min-height: 40px;
                font-size: 12px;
            }
            
            .info {
                font-size: 11px;
                padding: 10px 12px;
            }
            
            .info strong {
                font-size: 15px;
            }
        }
    </style>
</head>
<body data-theme="dark">
    <div class="header">
        <div class="controls">
            <input type="text" id="searchInput" placeholder="Search animals..." />
            <div class="custom-select" id="sortSelect">
                <div class="select-trigger">
                    <span>üî§ Name</span>
                    <span class="arrow">‚ñæ</span>
                </div>
                <div class="select-options">
                    <div class="option" data-value="alphabetical">üî§ Name</div>
                    <div class="option" data-value="heartrate">üíì BPM</div>
                    <div class="option" data-value="size">üìè Size</div>
                    <div class="option" data-value="empathy">‚ù§Ô∏è Empathy</div>
                </div>
            </div>
            <button id="cleanViewBtn" class="toggle-btn" onclick="toggleCleanView()" title="Toggle clean view">üßπ</button>
            <button id="themeBtn" onclick="toggleTheme()" title="Toggle theme">üåô</button>
            <button onclick="showExportModal()" title="Export options">üì§</button>
        </div>
        
        <div class="info">
            <div>
                <strong>Rhythms of Life</strong><br>
                <small>An interactive map of animal heartbeats and the empathy we humans feel for them</small><br>
                <small>Dot size = heart mass ‚Ä¢ Flicker rate = BPM ‚Ä¢ Touch for audio & haptics</small>
            </div>
        </div>
    </div>
    
    <div id="canvas-container">
        <div id="tooltip" class="tooltip"></div>
    </div>
    
    <footer style="background: var(--bg-secondary); padding: 20px; border-top: 1px solid var(--border-color); text-align: center; font-size: 12px; margin-top: 5px;">
        <div style="max-width: 1200px; margin: 0 auto;">
            <p style="margin: 0 0 15px 0; color: var(--text-secondary); line-height: 1.4;">
                This interactive experience explores the fascinating diversity of cardiovascular systems across the animal kingdom. 
                From the ultra-rapid 1400+ BPM hearts of tiny insects to the slow, powerful 26 BPM hearts of large birds, 
                each species has evolved a unique cardiac solution for survival.
            </p>
            <p style="margin: 0; color: var(--text-secondary);">
                <a href="#" onclick="requestAnimal(); return false;" style="color: var(--accent-color); text-decoration: none;">üêæ Request More Animals</a> | 
                Made with love by <a href="https://www.linkedin.com/in/pandeshivangi/" target="_blank" style="color: var(--accent-color); text-decoration: none;">Shivangi Pande</a>
            </p>
        </div>
    </footer>
    
    <div id="exportModal" class="export-modal">
        <div class="export-content">
            <h3>Export & Share</h3>
            <div class="export-options">
                <button onclick="exportScreenshot()">üì∏ Download PNG</button>
                <button onclick="copyLink()">üîó Copy Link</button>
                <button onclick="pledgeToProtect()">üõ°Ô∏è Pledge to Protect</button>
            </div>
            <div style="text-align: center; margin-top: 20px; color: var(--text-secondary); font-size: 12px;">
                Tap outside to close
            </div>
        </div>
    </div>
    
    <div id="introModal" class="intro-modal">
        <div class="intro-poem">
            Some hearts flicker like flames. Others echo slowly, like the earth breathing.
        </div>
        <div class="intro-arrow" onclick="closeIntroModal()"></div>
    </div>
    
    <div id="infoModal" class="info-modal">
        <div class="info-content">
            <h3>üíó Understanding the Empathy Scale</h3>
            <p>A visual scale of how emotionally connected humans typically feel to each species. This scale is based on real psychological studies and anthropomorphic traits.</p>
            
            <h4 style="color: var(--accent-color); font-size: 16px; margin: 20px 0 10px 0;">Key Factors:</h4>
            <ul>
                <li><strong>Facial resemblance</strong> - Eyes, expressions, and human-like features</li>
                <li><strong>Domestication/familiarity</strong> - Pets, cultural icons, stories</li>
                <li><strong>Vulnerability</strong> - Size, voice, cuteness factor</li>
                <li><strong>Cultural symbolism</strong> - Mythology, religion, folklore</li>
            </ul>
            
            <div class="empathy-scale-demo">
                <h4 style="margin-top: 0; color: var(--accent-color); font-size: 14px;">Scale Examples:</h4>
                <div class="scale-item">
                    <span>üíóüíóüíóüíóüíó Advanced</span>
                    <span style="color: var(--text-secondary);">Dogs, Cats, Horses</span>
                </div>
                <div class="scale-item">
                    <span>üíóüíóüíóüíóü§ç High</span>
                    <span style="color: var(--text-secondary);">Rabbits, Dolphins, Elephants</span>
                </div>
                <div class="scale-item">
                    <span>üíóüíóüíóü§çü§ç Moderate</span>
                    <span style="color: var(--text-secondary);">Farm Animals, Bears</span>
                </div>
                <div class="scale-item">
                    <span>üíóüíóü§çü§çü§ç Limited</span>
                    <span style="color: var(--text-secondary);">Fish, Birds, Reptiles</span>
                </div>
                <div class="scale-item">
                    <span>üíóü§çü§çü§çü§ç Basic</span>
                    <span style="color: var(--text-secondary);">Insects, Spiders</span>
                </div>
            </div>
            
            <p style="font-size: 12px; color: var(--text-secondary); font-style: italic;">
                Research sources include the <em>Anthrozo√∂s</em> journal, human-animal empathy studies in psychology, and cultural analysis of animals as moral agents in literature.
            </p>
            
            <div style="text-align: center; margin-top: 20px; color: var(--text-secondary); font-size: 12px;">
                Click outside to close
            </div>
        </div>
    </div>
    
    <script>
        let allAnimals = [];
        let visibleAnimals = [];
        let currentSort = 'alphabetical';
        let searchTerm = '';
        let cols = 8;
        let rows = 6;
        let canvasWidth = window.innerWidth;
        let canvasHeight = window.innerWidth < 768 ? window.innerHeight - 120 : window.innerHeight - 200;
        let cleanView = false;
        let isDarkTheme = true;
        let hoveredAnimal = null;
        let tooltip;
        let isAscending = true;
        let audioContext;
        let currentHeartbeatInterval;
        let isAudioEnabled = false;
        
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                isAudioEnabled = true;
            } catch (e) {
                console.log('Web Audio API not supported');
                isAudioEnabled = false;
            }
        }
        
        function createHeartbeat(bpm) {
            if (!isAudioEnabled || !audioContext) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                let baseFreq;
                if (bpm < 50) {
                    baseFreq = 50;
                } else if (bpm < 100) {
                    baseFreq = 70;
                } else if (bpm < 200) {
                    baseFreq = 90;
                } else {
                    baseFreq = 110;
                }
                
                oscillator.frequency.setValueAtTime(baseFreq, audioContext.currentTime);
                oscillator.type = 'sine';
                
                const now = audioContext.currentTime;
                const duration = bpm < 60 ? 0.25 : 0.15;
                const volume = bpm < 60 ? 0.5 : 0.4;
                
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(volume, now + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration);
                
                oscillator.start(now);
                oscillator.stop(now + duration);
            } catch (error) {
                console.log('Audio playback error:', error);
            }
        }
        
        function startHeartbeatAudio(animal) {
            if (!isAudioEnabled || currentHeartbeatInterval) return;
            
            window.currentAnimal = animal;
            
            const rawInterval = 60000 / animal.bpm;
            let interval;
            
            if (rawInterval > 800) {
                interval = 800;
            } else if (rawInterval < 150) {
                interval = 150;
            } else {
                interval = rawInterval;
            }
            
            createHeartbeat(animal.bpm, animal.name);
            
            currentHeartbeatInterval = setInterval(() => {
                createHeartbeat(animal.bpm, animal.name);
            }, interval);
        }
        
        function stopHeartbeatAudio() {
            if (currentHeartbeatInterval) {
                clearInterval(currentHeartbeatInterval);
                currentHeartbeatInterval = null;
            }
        }
        
        function setup() {
            let canvas = createCanvas(canvasWidth, canvasHeight);
            canvas.parent('canvas-container');
            
            allAnimals = [
                {name: "ANT", bpm: 418, size: 5, heartMass: "0.0g", scientificName: "Myrmecia croslandi", category: "Insect", lifespan: "1-2 years", empathy: 1},
                {name: "GRASSHOPPER", bpm: 391, size: 6, heartMass: "0.0g", scientificName: "Schistocerca gregaria", category: "Insect", lifespan: "6-12 months", empathy: 1},
                {name: "MOTH", bpm: 369, size: 7, heartMass: "0.0g", scientificName: "Manduca sexta", category: "Moth", lifespan: "2-6 weeks", empathy: 1},
                {name: "BEE", bpm: 318, size: 8, heartMass: "0.0g", scientificName: "Bombus impatiens", category: "Insect", lifespan: "6 months", empathy: 2},
                {name: "FROG", bpm: 144, size: 15, heartMass: "0.04g", scientificName: "Rana clamitans", category: "Amphibian", lifespan: "8-10 years", empathy: 2},
                {name: "FISH", bpm: 380, size: 12, heartMass: "1g", scientificName: "Small fish species", category: "Fish", lifespan: "2-5 years", empathy: 2},
                {name: "SALMON", bpm: 120, size: 28, heartMass: "25g", scientificName: "Salmo salar", category: "Fish", lifespan: "4-6 years", empathy: 2},
                {name: "TUNA", bpm: 140, size: 45, heartMass: "180g", scientificName: "Thunnus thynnus", category: "Fish", lifespan: "15-30 years", empathy: 2},
                {name: "OCTOPUS", bpm: 45, size: 18, heartMass: "3g", scientificName: "Octopus vulgaris", category: "Mollusk", lifespan: "1-5 years", empathy: 3},
                {name: "CRAB", bpm: 200, size: 10, heartMass: "0.5g", scientificName: "Callinectes sapidus", category: "Crustacean", lifespan: "2-3 years", empathy: 2},
                {name: "SHRIMP", bpm: 350, size: 6, heartMass: "0.1g", scientificName: "Penaeus vannamei", category: "Crustacean", lifespan: "1-2 years", empathy: 1},
                {name: "MOUSE", bpm: 600, size: 8, heartMass: "0.1g", scientificName: "Mus musculus", category: "Mammal", lifespan: "1-3 years", empathy: 3},
                {name: "HAMSTER", bpm: 450, size: 10, heartMass: "0.5g", scientificName: "Mesocricetus auratus", category: "Mammal", lifespan: "2-3 years", empathy: 4},
                {name: "RABBIT", bpm: 220, size: 18, heartMass: "6g", scientificName: "Oryctolagus cuniculus", category: "Mammal", lifespan: "8-12 years", empathy: 4},
                {name: "CAT", bpm: 180, size: 25, heartMass: "15g", scientificName: "Felis catus", category: "Mammal", lifespan: "12-18 years", empathy: 5},
                {name: "DOG", bpm: 120, size: 35, heartMass: "150g", scientificName: "Canis familiaris", category: "Mammal", lifespan: "10-13 years", empathy: 5},
                {name: "CHICKEN", bpm: 280, size: 22, heartMass: "10g", scientificName: "Gallus gallus", category: "Bird", lifespan: "5-10 years", empathy: 3},
                {name: "DUCK", bpm: 190, size: 24, heartMass: "8g", scientificName: "Anas platyrhynchos", category: "Bird", lifespan: "5-10 years", empathy: 3},
                {name: "TURKEY", bpm: 93, size: 38, heartMass: "45g", scientificName: "Meleagris gallopavo", category: "Bird", lifespan: "10 years", empathy: 3},
                {name: "GOOSE", bpm: 120, size: 42, heartMass: "65g", scientificName: "Anser anser", category: "Bird", lifespan: "20-30 years", empathy: 3},
                {name: "QUAIL", bpm: 250, size: 12, heartMass: "0.58g", scientificName: "Coturnix coturnix", category: "Bird", lifespan: "3-5 years", empathy: 2},
                {name: "PIGEON", bpm: 350, size: 16, heartMass: "4g", scientificName: "Columba livia", category: "Bird", lifespan: "6 years", empathy: 2},
                {name: "OSTRICH", bpm: 60, size: 95, heartMass: "900g", scientificName: "Struthio camelus", category: "Bird", lifespan: "40-45 years", empathy: 3},
                {name: "PIG", bpm: 85, size: 65, heartMass: "500g", scientificName: "Sus scrofa", category: "Mammal", lifespan: "15-20 years", empathy: 3},
                {name: "SHEEP", bpm: 75, size: 55, heartMass: "250g", scientificName: "Ovis aries", category: "Mammal", lifespan: "10-12 years", empathy: 3},
                {name: "GOAT", bpm: 90, size: 48, heartMass: "200g", scientificName: "Capra hircus", category: "Mammal", lifespan: "15-18 years", empathy: 3},
                {name: "COW", bpm: 65, size: 85, heartMass: "2500g", scientificName: "Bos taurus", category: "Mammal", lifespan: "18-22 years", empathy: 3},
                {name: "BUFFALO", bpm: 55, size: 90, heartMass: "3200g", scientificName: "Bubalus bubalis", category: "Mammal", lifespan: "20-25 years", empathy: 3},
                {name: "DEER", bpm: 70, size: 52, heartMass: "300g", scientificName: "Odocoileus virginianus", category: "Mammal", lifespan: "10-13 years", empathy: 4},
                {name: "CAMEL", bpm: 50, size: 88, heartMass: "4500g", scientificName: "Camelus dromedarius", category: "Mammal", lifespan: "40-50 years", empathy: 3},
                {name: "YAK", bpm: 45, size: 92, heartMass: "5000g", scientificName: "Bos grunniens", category: "Mammal", lifespan: "20-25 years", empathy: 3},
                {name: "HORSE", bpm: 38, size: 95, heartMass: "4000g", scientificName: "Equus caballus", category: "Mammal", lifespan: "25-30 years", empathy: 5},
                {name: "HUMAN", bpm: 72, size: 50, heartMass: "300g", scientificName: "Homo sapiens", category: "Mammal", lifespan: "70-80 years", empathy: 5},
                {name: "SWAN", bpm: 80, size: 58, heartMass: "35g", scientificName: "Cygnus olor", category: "Bird", lifespan: "20-30 years", empathy: 4},
                {name: "EMU", bpm: 27, size: 75, heartMass: "29.92g", scientificName: "Dromaius novaehollandiae", category: "Bird", lifespan: "10-20 years", empathy: 2},
                {name: "CASSOWARY", bpm: 26, size: 80, heartMass: "37.66g", scientificName: "Casuarius casuarius", category: "Bird", lifespan: "40-50 years", empathy: 2}
            ];
            
            tooltip = document.getElementById('tooltip');
            initializeAnimals();
            updateDisplay();
            
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            document.getElementById('sortSelect').addEventListener('change', handleSort);
            
            window.addEventListener('resize', handleResize);
            
            canvas.canvas.addEventListener('mousemove', handleMouseMove);
            canvas.canvas.addEventListener('mouseleave', hideTooltip);
            
            canvas.canvas.addEventListener('touchstart', handleTouchStart);
            canvas.canvas.addEventListener('touchmove', handleTouchMove);
            canvas.canvas.addEventListener('touchend', handleTouchEnd);
            
            setTimeout(() => {
                document.getElementById('introModal').style.display = 'flex';
            }, 500);
            
            initAudio();
        }
        
        function initializeAnimals() {
            for (let animal of allAnimals) {
                animal.phase = 0;
                animal.intensity = 0;
                animal.lastBeat = 0;
                animal.beatInterval = 60000 / animal.bpm;
                animal.x = 0;
                animal.y = 0;
            }
        }
        
        function updateDisplay() {
            if (searchTerm) {
                visibleAnimals = allAnimals.filter(animal => 
                    animal.name.toLowerCase().includes(searchTerm.toLowerCase())
                );
            } else {
                visibleAnimals = [...allAnimals];
            }
            
            if (currentSort === 'alphabetical') {
                visibleAnimals.sort((a, b) => a.name.localeCompare(b.name));
            } else if (currentSort === 'heartrate') {
                visibleAnimals.sort((a, b) => a.bpm - b.bpm);
            } else if (currentSort === 'size') {
                visibleAnimals.sort((a, b) => b.size - a.size);
            } else if (currentSort === 'empathy') {
                visibleAnimals.sort((a, b) => b.empathy - a.empathy);
            }
            
            let screenWidth = window.innerWidth;
            let screenHeight = window.innerWidth < 768 ? window.innerHeight - 120 : window.innerHeight - 200;
            
            let numAnimals = visibleAnimals.length;
            if (numAnimals === 0) return;
            
            if (screenWidth < 768) {
                cols = 3;
            } else if (screenWidth < 1024) {
                cols = 6;
            } else if (screenWidth < 1440) {
                cols = 8;
            } else {
                cols = Math.min(10, numAnimals);
            }
            
            cols = Math.min(cols, numAnimals);
            rows = Math.ceil(numAnimals / cols);
            
            let marginX = screenWidth < 768 ? 20 : Math.max(20, screenWidth * 0.03);
            let marginY = screenWidth < 768 ? 30 : Math.max(30, screenHeight * 0.05);
            let availableWidth = screenWidth - (marginX * 2);
            
            let cellWidth = availableWidth / cols;
            let cellHeight = screenWidth < 768 ? 150 : screenHeight > 0 ? (screenHeight - (marginY * 2)) / rows : cellWidth;
            
            if (screenWidth < 768) {
                let totalCanvasHeight = (rows * cellHeight) + (marginY * 2);
                resizeCanvas(canvasWidth, totalCanvasHeight);
            }
            
            let maxHeartSize = Math.max(...visibleAnimals.map(a => a.size));
            let availableCellSpace = Math.min(cellWidth, cellHeight) - 60;
            let scaleFactor = availableCellSpace / (maxHeartSize * 2);
            
            scaleFactor = Math.max(0.2, Math.min(scaleFactor, 1.0));
            
            for (let i = 0; i < visibleAnimals.length; i++) {
                let col = i % cols;
                let row = Math.floor(i / cols);
                
                visibleAnimals[i].x = marginX + (col * cellWidth) + (cellWidth / 2);
                visibleAnimals[i].y = marginY + (row * cellHeight) + (cellHeight / 2);
                
                visibleAnimals[i].displaySize = visibleAnimals[i].size * scaleFactor;
            }
        }
        
        function draw() {
            if (isDarkTheme) {
                background(26, 26, 26);
            } else {
                background(245, 245, 245);
            }
            
            let currentTime = millis();
            
            for (let animal of visibleAnimals) {
                updateHeartbeat(animal, currentTime);
                drawHeart(animal);
                drawLabel(animal);
            }
            
            if (visibleAnimals.length === 0) {
                fill(isDarkTheme ? 100 : 150);
                textAlign(CENTER, CENTER);
                textSize(16);
                text("No animals found matching your search", width/2, height/2);
            }
        }
        
        function updateHeartbeat(animal, currentTime) {
            if (currentTime - animal.lastBeat >= animal.beatInterval) {
                animal.lastBeat = currentTime;
                animal.phase = 0;
                
                if (hoveredAnimal === animal) {
                    createHeartbeat(animal);
                    triggerHapticFeedback();
                }
            }
            
            let beatProgress = (currentTime - animal.lastBeat) / animal.beatInterval;
            
            if (beatProgress < 0.1) {
                animal.intensity = map(beatProgress, 0, 0.1, 0, 1);
                animal.intensity = easeOutQuart(animal.intensity);
            } else if (beatProgress < 0.3) {
                animal.intensity = map(beatProgress, 0.1, 0.3, 1, 0.2);
                animal.intensity = easeInQuart(animal.intensity);
            } else {
                animal.intensity = map(beatProgress, 0.3, 1, 0.2, 0);
                animal.intensity = max(0, animal.intensity);
            }
        }
        
        function triggerHapticFeedback() {
            if (navigator.vibrate) {
                navigator.vibrate(50);
            } else if (window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(response => {
                    if (response === 'granted' && navigator.vibrate) {
                        navigator.vibrate(50);
                    }
                });
            }
        }
        
        function drawHeart(animal) {
            push();
            translate(animal.x, animal.y);
            
            let baseSize = animal.displaySize || animal.size;
            let currentSize = baseSize + (animal.intensity * baseSize * 0.6);
            
            let red = isDarkTheme ? 255 : 214;
            let green = map(animal.intensity, 0, 1, 0, 50);
            let blue = map(animal.intensity, 0, 1, 0, isDarkTheme ? 50 : 132);
            let alpha = map(animal.intensity, 0, 1, 150, 255);
            
            if (animal.intensity > 0.1) {
                let glowSize = currentSize * 1.8;
                let glowAlpha = animal.intensity * 60;
                
                for (let i = 0; i < 4; i++) {
                    let size = map(i, 0, 3, currentSize, glowSize);
                    let a = map(i, 0, 3, glowAlpha, 0);
                    fill(red, 0, 0, a);
                    noStroke();
                    ellipse(0, 0, size);
                }
            }
            
            fill(red, green, blue, alpha);
            noStroke();
            ellipse(0, 0, currentSize);
            
            fill(255, 100, 100, animal.intensity * 150);
            ellipse(-currentSize/6, -currentSize/6, currentSize/4);
            
            pop();
        }
        
        function drawLabel(animal) {
            push();
            
            let baseSize = animal.displaySize || animal.size;
            let scaleFactor = Math.max(0.6, Math.min(1.2, baseSize / 20));
            
            fill(isDarkTheme ? 255 : 51, isDarkTheme ? 255 : 51, isDarkTheme ? 255 : 51, 200);
            textAlign(CENTER);
            textSize(Math.max(8, 9 * scaleFactor));
            textStyle(BOLD);
            text(animal.name, animal.x, animal.y - baseSize - 12);
            
            if (!cleanView) {
                fill(isDarkTheme ? 255 : 214, 100, isDarkTheme ? 100 : 132, 180);
                textSize(Math.max(7, 8 * scaleFactor));
                textStyle(NORMAL);
                text(animal.bpm + " BPM", animal.x, animal.y + baseSize + 10);
                
                fill(isDarkTheme ? 150 : 102, isDarkTheme ? 150 : 102, isDarkTheme ? 150 : 102, 150);
                textSize(Math.max(6, 7 * scaleFactor));
                text(animal.heartMass, animal.x, animal.y + baseSize + 20);
            }
            
            pop();
        }
        
        function handleMouseMove(event) {
            let rect = event.target.getBoundingClientRect();
            let mouseX = event.clientX - rect.left;
            let mouseY = event.clientY - rect.top;
            
            checkAnimalHover(mouseX, mouseY, event);
        }
        
        function handleTouchStart(event) {
            let touch = event.touches[0];
            let rect = event.target.getBoundingClientRect();
            let touchX = touch.clientX - rect.left;
            let touchY = touch.clientY - rect.top;
            
            // Check if touch is over an animal before preventing default
            let touchedAnimal = null;
            for (let animal of visibleAnimals) {
                let distance = dist(touchX, touchY, animal.x, animal.y);
                let baseSize = animal.displaySize || animal.size;
                
                if (distance < baseSize + 15) {
                    touchedAnimal = animal;
                    break;
                }
            }
            
            // Only prevent default if touching an animal
            if (touchedAnimal) {
                event.preventDefault();
                checkAnimalHover(touchX, touchY, event);
            }
        }
        
        function handleTouchMove(event) {
            let touch = event.touches[0];
            let rect = event.target.getBoundingClientRect();
            let touchX = touch.clientX - rect.left;
            let touchY = touch.clientY - rect.top;
            
            // Check if we're currently hovering over an animal
            if (hoveredAnimal) {
                event.preventDefault(); // Only prevent scrolling when actively interacting with an animal
                checkAnimalHover(touchX, touchY, event);
            } else {
                // Allow normal scrolling when not interacting with animals
                checkAnimalHover(touchX, touchY, event);
            }
        }
        
        function handleTouchEnd(event) {
            // Only prevent default if we were interacting with an animal
            if (hoveredAnimal) {
                event.preventDefault();
            }
            hideTooltip();
        }
        
        function checkAnimalHover(x, y, event) {
            let previousHoveredAnimal = hoveredAnimal;
            hoveredAnimal = null;
            
            for (let animal of visibleAnimals) {
                let distance = dist(x, y, animal.x, animal.y);
                let baseSize = animal.displaySize || animal.size;
                
                if (distance < baseSize + 15) {
                    hoveredAnimal = animal;
                    showTooltip(event, animal, x, y);
                    
                    if (previousHoveredAnimal !== animal) {
                        stopHeartbeatAudio();
                        startHeartbeatAudio(animal);
                    }
                    return;
                }
            }
            
            if (previousHoveredAnimal !== null) {
                stopHeartbeatAudio();
            }
            hideTooltip();
        }
        
        function showTooltip(event, animal, x, y) {
            function getEmpathyDisplay(level) {
                const hearts = '‚ù§Ô∏è'.repeat(level) + 'ü§ç'.repeat(5 - level);
                return hearts;
            }
            
            tooltip.innerHTML = `
                <h4>${animal.name}</h4>
                <div class="stat">
                    <span class="stat-label">Heart Rate:</span>
                    <span class="stat-value">${animal.bpm} BPM</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Heart Size:</span>
                    <span class="stat-value">${animal.size}</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Heart Mass:</span>
                    <span class="stat-value">${animal.heartMass}</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Category:</span>
                    <span class="stat-value">${animal.category}</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Lifespan:</span>
                    <span class="stat-value">${animal.lifespan}</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Empathy Scale:</span>
                    <span class="stat-value">${getEmpathyDisplay(animal.empathy)}</span>
                </div>
            `;
            
            tooltip.style.display = 'block';
            
            let tooltipRect = tooltip.getBoundingClientRect();
            let baseSize = animal.displaySize || animal.size;
            
            let spacing = 12;
            let dotRadius = (baseSize + (animal.intensity * baseSize * 0.6)) / 2;
            
            let posX = x !== undefined ? x : animal.x;
            let posY = y !== undefined ? y : animal.y;
            
            let tooltipX = posX + dotRadius + spacing;
            let tooltipY = posY - tooltipRect.height / 2;
            
            if (tooltipX + tooltipRect.width > window.innerWidth - 10) {
                tooltipX = posX - dotRadius - spacing - tooltipRect.width;
            }
            
            if (tooltipX < 10) {
                tooltipX = posX - tooltipRect.width / 2;
                
                tooltipY = posY - dotRadius - spacing - tooltipRect.height;
                
                if (tooltipY < 10) {
                    tooltipY = posY + dotRadius + spacing;
                }
            }
            
            tooltipX = Math.max(10, Math.min(tooltipX, window.innerWidth - tooltipRect.width - 10));
            tooltipY = Math.max(10, Math.min(tooltipY, window.innerHeight - tooltipRect.height - 10));
            
            tooltip.style.left = tooltipX + 'px';
            tooltip.style.top = tooltipY + 'px';
        }
        
        function hideTooltip() {
            tooltip.style.display = 'none';
            hoveredAnimal = null;
            stopHeartbeatAudio();
        }
        
        function toggleCleanView() {
            cleanView = !cleanView;
            let btn = document.getElementById('cleanViewBtn');
            if (cleanView) {
                btn.textContent = 'üìã';
                btn.title = 'Show details';
                btn.classList.add('active');
            } else {
                btn.textContent = 'üßπ';
                btn.title = 'Clean view';
                btn.classList.remove('active');
            }
        }
        
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            let btn = document.getElementById('themeBtn');
            let body = document.body;
            
            if (isDarkTheme) {
                body.setAttribute('data-theme', 'dark');
                btn.textContent = 'üåô';
                btn.title = 'Switch to light mode';
            } else {
                body.setAttribute('data-theme', 'light');
                btn.textContent = '‚òÄÔ∏è';
                btn.title = 'Switch to dark mode';
            }
        }
        
        function showInfoModal() {
            document.getElementById('infoModal').style.display = 'flex';
        }
        
        function closeInfoModal() {
            document.getElementById('infoModal').style.display = 'none';
        }
        
        function closeIntroModal() {
            document.getElementById('introModal').style.display = 'none';
            
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    isAudioEnabled = true;
                });
            }
        }
        
        function requestAnimal() {
            let animalName = prompt("What animal would you like to see added?\n\nPlease enter the animal name:");
            
            if (animalName && animalName.trim() !== '') {
                let subject = encodeURIComponent("Animal Request for Heartbeat Database");
                let body = encodeURIComponent(`Hello!\n\nI would like to request adding the following animal to the Animal Heartbeat Database:\n\nAnimal: ${animalName.trim()}\n\nThanks!`);
                let mailtoLink = `mailto:your-email@example.com?subject=${subject}&body=${body}`;
                
                window.location.href = mailtoLink;
                
                alert(`Thank you! Your request for "${animalName.trim()}" will be sent via email.`);
            }
        }
        
        function showExportModal() {
            document.getElementById('exportModal').style.display = 'flex';
        }
        
        function closeExportModal() {
            document.getElementById('exportModal').style.display = 'none';
        }
        
        function exportScreenshot() {
            let originalCleanView = cleanView;
            cleanView = true;
            
            draw();
            
            saveCanvas('rhythms-of-life-heartbeats', 'png');
            
            cleanView = originalCleanView;
            
            closeExportModal();
        }
        
        function copyLink() {
            const currentUrl = window.location.href;
            
            navigator.clipboard.writeText(currentUrl).then(() => {
                alert('Link copied to clipboard! üìã‚ú®');
                closeExportModal();
            }).catch(() => {
                prompt('Copy this link:', currentUrl);
                closeExportModal();
            });
        }
        
        function pledgeToProtect() {
            window.open('https://www.peta.org/', '_blank');
            closeExportModal();
        }
        
        function handleResize() {
            canvasWidth = window.innerWidth;
            canvasHeight = window.innerWidth < 768 ? window.innerHeight - 120 : window.innerHeight - 200;
            resizeCanvas(canvasWidth, canvasHeight);
            updateDisplay();
        }
        
        function handleSearch() {
            searchTerm = document.getElementById('searchInput').value;
            updateDisplay();
        }
        
        function handleSort() {
            let sortValue;
            if (document.getElementById('sortSelect').classList) {
                const selectedOption = document.querySelector('.option.selected');
                sortValue = selectedOption ? selectedOption.dataset.value : 'alphabetical';
            } else {
                sortValue = document.getElementById('sortSelect').value;
            }
            currentSort = sortValue;
            updateDisplay();
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const customSelect = document.getElementById('sortSelect');
            const trigger = customSelect.querySelector('.select-trigger');
            const options = customSelect.querySelectorAll('.option');
            
            const dropdown = customSelect.querySelector('.select-options');
            document.body.appendChild(dropdown);
            
            trigger.addEventListener('click', function(e) {
                e.stopPropagation();
                
                if (dropdown.style.display === 'block') {
                    dropdown.style.display = 'none';
                    customSelect.classList.remove('open');
                } else {
                    const rect = trigger.getBoundingClientRect();
                    dropdown.style.display = 'block';
                    dropdown.style.top = (rect.bottom + window.scrollY + 2) + 'px';
                    dropdown.style.left = (rect.left + window.scrollX) + 'px';
                    dropdown.style.width = rect.width + 'px';
                    customSelect.classList.add('open');
                }
            });
            
            options.forEach(option => {
                option.addEventListener('click', function() {
                    trigger.querySelector('span').textContent = this.textContent;
                    
                    options.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    dropdown.style.display = 'none';
                    customSelect.classList.remove('open');
                    
                    currentSort = this.dataset.value;
                    updateDisplay();
                });
            });
            
            document.addEventListener('click', function() {
                dropdown.style.display = 'none';
                customSelect.classList.remove('open');
            });
            
            options[0].classList.add('selected');
        });
        
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            searchTerm = '';
            updateDisplay();
        }
        
        function easeOutQuart(t) {
            return 1 - pow(1 - t, 4);
        }
        
        function easeInQuart(t) {
            return t * t * t * t;
        }
        
        document.addEventListener('keydown', function(event) {
            if (event.key === 'c' || event.key === 'C') {
                toggleCleanView();
            } else if (event.key === 't' || event.key === 'T') {
                toggleTheme();
            } else if (event.key === 'e' || event.key === 'E') {
                showExportModal();
            } else if (event.key === 'Escape') {
                closeExportModal();
                closeIntroModal();
                closeInfoModal();
                hideTooltip();
            }
        });
        
        document.getElementById('exportModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeExportModal();
            }
        });
        
        document.getElementById('introModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeIntroModal();
            }
        });
        
        document.getElementById('infoModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeInfoModal();
            }
        });
    </script>
</body>
</html>
